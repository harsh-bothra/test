<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.19.2 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Exploitation with shellcode - aidenpearce369</title>
<meta name="description" content="A simple explanation on syscalls and how to craft shellcodes with specific function ">


  <meta name="author" content="Monish Kumar">


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="aidenpearce369">
<meta property="og:title" content="Exploitation with shellcode">
<meta property="og:url" content="http://localhost:4000/exploit%20development/shellcodeexploit/">


  <meta property="og:description" content="A simple explanation on syscalls and how to craft shellcodes with specific function ">



  <meta property="og:image" content="http://localhost:4000/assets/images/expdev/expdev.png">





  <meta property="article:published_time" content="2021-03-26T00:00:00+05:30">





  

  


<link rel="canonical" href="http://localhost:4000/exploit%20development/shellcodeexploit/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Monish Kumar",
      "url": "http://localhost:4000/"
    
  }
</script>


  <meta name="google-site-verification" content="J3MnMF94zaZhTUoNtUiRt9cKsr7hiMyTxEdAvQ3GfmY" />





<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="aidenpearce369 Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

<!-- favicon -->
<link rel="icon" type="image/png" sizes="32x32" href="/assets/images/site_data/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/images/site_data/favicon-16x16.png">
<meta name="theme-color" content="#ffffff">

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          aidenpearce369
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/pwn">Pwn Challenges</a>
            </li><li class="masthead__menu-item">
              <a href="/binexp">Binary Exploitation</a>
            </li><li class="masthead__menu-item">
              <a href="/expdev">Exploit Development</a>
            </li><li class="masthead__menu-item">
              <a href="/categories">All Categories</a>
            </li><li class="masthead__menu-item">
              <a href="/tags">Tags</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/images/site_data/avatar.png" alt="Monish Kumar" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Monish Kumar</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Security Analyst and Youtuber</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Chennai, India</span>
        </li>
      

      
        
          
            <li><a href="mailto:driftmonianonymous@gmail.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span></a></li>
          
        
          
        
          
            <li><a href="https://twitter.com/aidenpearce369" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
        
          
            <li><a href="https://www.linkedin.com/in/aidenmonish/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
          
            <li><a href="https://github.com/aidenpearce369" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://youtube.com/c/ExploitEverything" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-youtube" aria-hidden="true"></i><span class="label">Youtube</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Exploitation with shellcode">
    <meta itemprop="description" content="">
    <meta itemprop="datePublished" content="2021-03-26T00:00:00+05:30">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Exploitation with shellcode
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  6 minute read

</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p><img src="https://miro.medium.com/max/3000/1*jJs1vy-iGBG8aPIOkbMk3A.png" alt="I" /></p>

<h1 id="exploitation-with-shellcode">EXPLOITATION WITH SHELLCODE</h1>

<p>Shellcode is a piece of code performs specific action</p>

<p>Shellcode is written in ASM</p>

<p>Shellcode is architecture specific, so it is non portable between different processor types</p>

<p>Shellcode is typically written to directly manipulate processor registers to set them up for various system calls made with opcodes</p>

<p>When the ASM code has been written to perform the operation desired, it must then be converted to machine code and freed of any “null bytes” , because it must be free of any null bytes because many string operators such as strcpy() terminate when hitting them</p>

<hr />

<h2 id="system-calls-syscall">SYSTEM CALLS (SYSCALL)</h2>

<p>System call (commonly abbreviated to syscall) is the programmatic way in which a computer program requests a service from the kernel of the operating system on which it is executed</p>

<p>System calls provide an essential interface between a process and the operating system</p>

<p>System calls can only be made from userspace processes</p>

<p>Privileged system code also issues system calls</p>

<p>An interrupt automatically puts the CPU into some elevated privilege level and then passes control to the kernel, which determines whether the calling program should be granted the requested service. If the service is granted, the kernel executes a specific set of instructions over which the calling program has no direct control, returns the privilege level to that of the calling program, and then returns control to the calling program.</p>

<p>System calls provide a way to manage communication to hardware and functionality offered by the kernel that may not be included in the application’s address space</p>

<p>Most systems use ring levels(commonly 4 privileged levels) to provide security and protection from allowing an application to directly access hardware and certain system functions</p>

<p>For a user-level program to access a function outside of its address space, such as setuid(), it must identify the system call number of the desired function and then send an interrupt 0x80 (int 0x80)</p>

<h4 id="note">NOTE</h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The instruction 'int 0x80/syscall' is an assembly instruction that invokes system calls on most *NIX OSs
</code></pre></div></div>

<h4 id="why-syscall">WHY SYSCALL?</h4>

<p>To enter kernel we can use Hardware Interrupt, Hardware Trap and Software Initiated Trap</p>

<p>We cannot trigger and use hardware related interrupts and traps</p>

<p>So lets use “Software Initiated Traps” to enter Kernel Mode</p>

<p>Systemcalls are a special case of software initiated trap. The machine instruction used to initiate a system call typically causes a hardware trap that is handled specially by the kernel</p>

<p>In Linux, the system calls are implemented using</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>lcall7/lcall27 gates (lcall7_func)
int0x80 (software interrupt)
</code></pre></div></div>

<h4 id="work-flow">WORK FLOW</h4>

<p>To perform a syscall , two or more arguments are required</p>

<p>The “syscall number” is loaded into “EAX register”</p>

<p>Arguments needed to be passed through syscall are stored in registers EBX,ECX and EDX(32bit) in the order followed by syscall table</p>

<p>In case of 64bit, QWORD registers and R8-R15 registers are used to store the arguments</p>

<h3 id="generating-a-sample-asm-code-for-syscall">GENERATING A SAMPLE ASM CODE FOR SYSCALL</h3>

<h4 id="example-1">EXAMPLE 1</h4>

<p>Lets trigger the exit(0) using syscall by ASM</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mov eax,1
mov ebx,0
int 0x80
</code></pre></div></div>

<p>Here EAX is loaded with 1, so it get the syscall with value 1</p>

<p>syscall_value = 1 —–&gt; syscall = sys_exit()</p>

<p>The value 0 is loaded into EBX so that it can be used as argument for syscall</p>

<p>int 0x80 is used to trigger interrupt and perform syscall</p>

<h4 id="example-2">EXAMPLE 2</h4>

<p>To spawn a “sh” shell using execve()</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mov eax,0x0 		//initialization
push edx 			//nullbyte to terminate string (0x0)
push 0x68732f2f 	//4bytes needed (//sh)['//' is same as '/'] little endian
push 0x6e69622f 	//4bytes needed (/bin) little endian
mov ebx, esp 		//moving SP into EBX
push edx 			//pushing EDX into stack (0x0)
push esp 			// ESP above EDX in stack
mov ecx, esp 		// ESP stored in ECX for argv
mov eax, 0x0b 		//loading eax with syscall value for execve()
int 0x80 			//calling syscall to perform interrupt
</code></pre></div></div>

<h3 id="more-on-syscall">MORE ON SYSCALL</h3>

<p>Type this command in terminal</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>man syscall
man 'syscall(2)'
</code></pre></div></div>

<p>Also refer this <a href="https://chromium.googlesource.com/chromiumos/docs/+/master/constants/syscalls.md">table</a> for more syscall values of each architecture</p>

<hr />

<h2 id="nullbytes-0x00">NULLBYTES 0x00</h2>

<h3 id="effect-of-null-bytes">EFFECT OF NULL BYTES</h3>

<p>Functions relying on a string operator such as strcpy(), to copy data into a buffer, and when these functions hit a null byte such as 0x00, they translate that as a string terminator. This, of course, causes our shellcode to fail</p>

<h3 id="cause-of-null-bytes">CAUSE OF NULL BYTES</h3>

<p>Assembly instructions cause null bytes to reside within your shellcode</p>

<p>Improper initialization of registers</p>

<h3 id="removing-null-bytes">REMOVING NULL BYTES</h3>

<h4 id="type-1">TYPE 1</h4>

<p>Consider you are using a register EAX (32bits/4bytes)</p>

<p>Whenever you are trying to store a small value in EAX(32bit)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mov eax,0x10
</code></pre></div></div>

<p>You can use AX(16bit) to store these small values(based on size)</p>

<p>Lower register AL(8bit) gets filled with values and Upper register AH(8bit) gets filled with NULLS</p>

<p>This causes null bytes when converting it into shellcode</p>

<p>Instead of loading small values in the whole register,</p>

<h6 id="we-can-use-its-halves">We can use its halves</h6>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mov al,0x10
</code></pre></div></div>

<h4 id="type-2">TYPE 2</h4>

<p>There comes a case in which we need to pass 0 as an argument to syscall</p>

<p>In that type of cases we could not load 0 into register, because it may create NULL BYTES in shellcode</p>

<p>To overcome this, we can store any arbitrary values in register and,</p>

<h6 id="we-can-xor-the-register">We can XOR the register</h6>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mov ebx,0x10
xor ebx,ebx
</code></pre></div></div>

<p>It is the best way because it does not affect the EFLAGS register</p>

<h4 id="type-3">TYPE 3</h4>

<h6 id="we-can-sub-the-register">We can SUB the register</h6>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mov ebx,0x10
sub ebx,ebx
</code></pre></div></div>

<h4 id="type-4">TYPE 4</h4>

<h6 id="inc-or-dec-the-register">INC or DEC the register</h6>

<p>Storing the count value in ECX</p>

<p>Performing INC(Increment) and DEC(Decrement)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>inc ebx
dec edx
</code></pre></div></div>

<h4 id="type-5">TYPE 5</h4>

<h6 id="moving-0-from-another-register">Moving 0 from another register</h6>

<p>Lets assume 0x00 is in EDX</p>

<p>To load the value in EBX and to prevent null bytes</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mov ebx,edx
</code></pre></div></div>

<hr />

<h2 id="generating-shellcodes">GENERATING SHELLCODES</h2>

<p>Lets assume a scenario where we want to call/spawn a shell from a attack vector</p>

<p>To spwan a shell we need to execute shellcode</p>

<p>And lets fix that we need to spawn “/bin/sh”</p>

<p>Lets replica this <a href="https://www.exploit-db.com/exploits/44321">execve shellcode</a></p>

<h3 id="common-code-structure">COMMON CODE STRUCTURE</h3>

<p>Common code structure to execute our shellcode using C program as an exploit is</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>char shellcode[] = "SHELLCODE HERE";
int main(int argc, char **argv){
	int (*attack)();
	attack = (int (*)())shellcode;
	(int)(*attack)();
}
</code></pre></div></div>

<p>OR</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>char shellcode[] = "SHELLCODE HERE";
int main(int argc, char **argv){
	((int (*)())shellcode)();
}
</code></pre></div></div>

<h3 id="exploit">EXPLOIT</h3>

<p>Before we attack we need to check the architecture of the victim machine</p>

<p><img src="https://miro.medium.com/max/226/0*zqkEi4oaZYmOPlRK.png" alt="I" /></p>

<p>Lets script the ASM code in editor to process it</p>

<p><img src="https://miro.medium.com/max/700/0*sg98YorXDoA5aPN2.png" alt="I" /></p>

<p>Now,lets test the exploit generated from ASM code</p>

<p><img src="https://miro.medium.com/max/700/0*KJElfODGWk_Wtddn.png" alt="I" /></p>

<p>Run “objdump” to view the hexvalues of each ASM instruction to craft shellcode</p>

<p><img src="https://miro.medium.com/max/700/0*LCMmk9yv8LsvchQa.png" alt="I" /></p>

<h5 id="this-is-the-shellcode-for-our-exploit">This is the SHELLCODE for our exploit</h5>

<p>Copy the shellcode and embed it in another script so that it can run in executable memory</p>

<p><img src="https://miro.medium.com/max/700/0*8Czyuzz7cQDCH_uF.png" alt="I" /></p>

<p>Compile the source code with “-z execstack” and “-nostdlib” to avoid “segmentation fault” and allowing the binary to run in executable memory</p>

<p><img src="https://miro.medium.com/max/700/0*R4ougo2wraihCNrt.png" alt="I" /></p>

<h3 id="exploit-is-done">EXPLOIT IS DONE</h3>

<h4 id="exploit-sample-is-given-in-github-repo">Exploit Sample Is Given In GitHub Repo</h4>

<h4 id="aidenpearce369"><a href="https://github.com/AidenPearce369/ExploitDev">AidenPearce369</a></h4>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#shellcode" class="page__taxonomy-item" rel="tag">shellcode</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#exploit-development" class="page__taxonomy-item" rel="tag">Exploit Development</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2021-03-26T00:00:00+05:30">March 26, 2021</time></p>
        
      </footer>

      

      
  <nav class="pagination">
    
      <a href="#" class="pagination--pager disabled">Previous</a>
    
    
      <a href="/exploit%20development/formatstring/" class="pagination--pager" title="Format String Vulnerability
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2021 Monish Kumar. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
